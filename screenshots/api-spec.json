{"openapi":"3.1.0","info":{"title":"Tallow API","description":"\n# Tallow API Documentation\n\nSecure peer-to-peer file transfer API with end-to-end encryption, group transfers, and device discovery.\n\n## Features\n\n- **Secure File Transfer**: End-to-end encrypted P2P file transfers\n- **Group Transfers**: Send files to multiple devices simultaneously using room codes\n- **Device Discovery**: Automatic device discovery via mDNS on local networks\n- **Health Monitoring**: Comprehensive health checks for container orchestration\n- **Rate Limiting**: Built-in rate limiting to prevent abuse\n- **CSRF Protection**: Secure cross-site request forgery protection\n- **Metadata Stripping**: Automatic metadata removal from transferred files\n\n## Authentication\n\nThe API supports optional authentication methods:\n- **Bearer Token**: JWT or session tokens for authenticated requests\n- **API Key**: X-API-Key header for programmatic access (optional)\n\nUnauthenticated requests are supported for public operations.\n\n## Rate Limits\n\nRate limits are enforced per endpoint to ensure fair usage:\n- **GET /api/rooms**: 60 requests/minute\n- **POST /api/rooms**: 10 requests/minute (strict - prevent spam)\n- **DELETE /api/rooms**: 30 requests/minute\n- **GET /api/health**: 100 requests/minute\n- **GET /api/metrics**: 30 requests/minute\n\nSee individual endpoint documentation for specific limits.\n\n## Error Handling\n\nAll API errors follow a consistent format:\n\n```json\n{\n  \"error\": \"Error message\",\n  \"code\": \"ERROR_CODE\",\n  \"timestamp\": \"2026-02-06T12:00:00Z\"\n}\n```\n\nCommon error codes:\n- `BAD_REQUEST` (400): Invalid request parameters\n- `UNAUTHORIZED` (401): Missing or invalid authentication\n- `FORBIDDEN` (403): Insufficient permissions\n- `NOT_FOUND` (404): Resource not found\n- `CONFLICT` (409): Resource already exists\n- `GONE` (410): Resource no longer available\n- `RATE_LIMIT_EXCEEDED` (429): Too many requests\n- `INTERNAL_ERROR` (500): Server error\n\n## CORS\n\nCross-Origin requests are supported with configurable allowed origins. Set `ALLOWED_ORIGINS` environment variable to comma-separated list of allowed domains.\n\n## Versioning\n\nCurrent API version: 1.0.0\n\nBreaking changes will increment the major version. Migration guides will be provided for deprecated endpoints.\n\n## Support\n\nFor API support and questions:\n- GitHub Issues: https://github.com/tallow/issues\n- GitHub Discussions: https://github.com/tallow/discussions\n- Email: support@tallow.app\n    ","version":"1.0.0","contact":{"name":"Tallow Support","url":"https://github.com/tallow"},"license":{"name":"MIT","url":"https://opensource.org/licenses/MIT"}},"servers":[{"url":"http://localhost:3000","description":"Local development server"},{"url":"https://api.tallow.app","description":"Production server","variables":{"version":{"default":"v1","enum":["v1"]}}}],"paths":{"/api/health":{"get":{"operationId":"getHealth","tags":["Health"],"summary":"Health Check","description":"Basic health check endpoint for container orchestration and monitoring. Returns 200 if service is running, 503 if unhealthy. No dependencies are checked.","parameters":[],"responses":{"200":{"description":"Service is healthy","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthResponse"},"example":{"status":"ok","service":"tallow","version":"1.0.0","timestamp":"2026-02-06T12:00:00Z","uptime":3600.5}}}},"503":{"description":"Service is unhealthy","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"status":"error","service":"tallow","timestamp":"2026-02-06T12:00:00Z","error":"Service initialization failed"}}}}},"x-codeSamples":[{"lang":"curl","source":"curl -X GET http://localhost:3000/api/health"},{"lang":"javascript","source":"fetch(\"http://localhost:3000/api/health\").then(r => r.json())"},{"lang":"python","source":"import requests\nrequests.get(\"http://localhost:3000/api/health\").json()"}]}},"/api/health/liveness":{"get":{"operationId":"getLiveness","tags":["Health"],"summary":"Liveness Probe","description":"Kubernetes liveness probe endpoint. Returns 200 if the application process is running. Used for container restart policies.","parameters":[],"responses":{"200":{"description":"Service is alive","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LivenessResponse"},"example":{"status":"alive","timestamp":"2026-02-06T12:00:00Z"}}}}},"x-codeSamples":[{"lang":"curl","source":"curl -X GET http://localhost:3000/api/health/liveness"},{"lang":"curl-head","source":"curl -X HEAD http://localhost:3000/api/health/liveness"}]},"head":{"operationId":"livenessProbeHead","tags":["Health"],"summary":"Liveness Probe (HEAD)","description":"HEAD request for liveness probe. Returns 200 with no body.","parameters":[],"responses":{"200":{"description":"Service is alive"}}}},"/api/health/readiness":{"get":{"operationId":"getReadiness","tags":["Health"],"summary":"Readiness Probe","description":"Kubernetes readiness probe endpoint. Checks if all dependencies are available and the service is ready to handle traffic. Returns 200 if ready, 503 if not.","parameters":[],"responses":{"200":{"description":"Service is ready","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ReadinessResponse"},"example":{"status":"ready","timestamp":"2026-02-06T12:00:00Z","checks":[{"name":"environment","status":"healthy","responseTime":5},{"name":"memory","status":"healthy","responseTime":3}]}}}},"503":{"description":"Service is not ready","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ReadinessResponse"},"example":{"status":"not ready","timestamp":"2026-02-06T12:00:00Z","checks":[{"name":"environment","status":"unhealthy","responseTime":4,"error":"Missing required environment variables: NEXT_PUBLIC_SIGNALING_URL"}]}}}}},"x-codeSamples":[{"lang":"curl","source":"curl -X GET http://localhost:3000/api/health/readiness"},{"lang":"curl-head","source":"curl -X HEAD http://localhost:3000/api/health/readiness"}]},"head":{"operationId":"readinessProbeHead","tags":["Health"],"summary":"Readiness Probe (HEAD)","description":"HEAD request for readiness probe. Returns 200 if ready, 503 if not.","parameters":[],"responses":{"200":{"description":"Service is ready"},"503":{"description":"Service is not ready"}}}},"/api/rooms":{"get":{"operationId":"getRoom","tags":["Rooms"],"summary":"Get Room Information","description":"Retrieve information about a specific room by its code. Returns room details including member count, expiration, and password protection status. Requires valid room code.","parameters":[{"name":"code","in":"query","required":true,"description":"Room code (4-8 alphanumeric characters, case-insensitive)","schema":{"type":"string","pattern":"^[A-Z0-9]{4,8}$","example":"ABCD1234"}}],"responses":{"200":{"description":"Room found and returned","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RoomResponse"},"example":{"id":"room-uuid-1234","code":"ABCD1234","name":"Engineering Team Transfer","ownerId":"owner-uuid-5678","ownerName":"John Doe","createdAt":"2026-02-06T12:00:00Z","expiresAt":"2026-02-07T12:00:00Z","isPasswordProtected":true,"maxMembers":10,"memberCount":3}}}},"400":{"description":"Invalid room code format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"404":{"description":"Room not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"410":{"description":"Room has expired","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"429":{"description":"Rate limit exceeded (60 requests/minute)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}},"x-codeSamples":[{"lang":"curl","source":"curl -X GET \"http://localhost:3000/api/rooms?code=ABCD1234\""},{"lang":"javascript","source":"const code = 'ABCD1234';\nfetch(`http://localhost:3000/api/rooms?code=${code}`)\n  .then(r => r.json())\n  .then(data => console.log(data));"},{"lang":"python","source":"import requests\ncode = 'ABCD1234'\nresponse = requests.get(f'http://localhost:3000/api/rooms?code={code}')\nprint(response.json())"}]},"post":{"operationId":"createRoom","tags":["Rooms"],"summary":"Create Room","description":"Create a new transfer room for group file transfers. Requires CSRF token. Rate limited to 10 requests/minute to prevent spam. Returns room details including the room code.","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateRoomRequest"},"example":{"id":"room-uuid-1234","code":"ABCD1234","name":"Engineering Team Transfer","ownerId":"owner-uuid-5678","ownerName":"John Doe","maxMembers":10,"password":"SecurePassword123","expiresAt":"2026-02-07T12:00:00Z"}}}},"responses":{"201":{"description":"Room created successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateRoomResponse"},"example":{"success":true,"room":{"id":"room-uuid-1234","code":"ABCD1234","name":"Engineering Team Transfer","ownerId":"owner-uuid-5678","createdAt":"2026-02-06T12:00:00Z","expiresAt":"2026-02-07T12:00:00Z","isPasswordProtected":true,"maxMembers":10}}}}},"400":{"description":"Invalid request parameters","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"403":{"description":"CSRF token missing or invalid","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"409":{"description":"Room code already exists","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"429":{"description":"Rate limit exceeded (10 requests/minute)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}},"x-codeSamples":[{"lang":"curl","source":"curl -X POST http://localhost:3000/api/rooms \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-CSRF-Token: token-value\" \\\n  -d '{\n    \"id\": \"room-uuid-1234\",\n    \"code\": \"ABCD1234\",\n    \"name\": \"Engineering Team\",\n    \"ownerId\": \"owner-uuid-5678\",\n    \"ownerName\": \"John Doe\",\n    \"maxMembers\": 10\n  }'"},{"lang":"javascript","source":"const roomData = {\n  id: 'room-uuid-1234',\n  code: 'ABCD1234',\n  name: 'Engineering Team',\n  ownerId: 'owner-uuid-5678',\n  ownerName: 'John Doe',\n  maxMembers: 10\n};\n\nfetch('http://localhost:3000/api/rooms', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json',\n    'X-CSRF-Token': csrfToken\n  },\n  body: JSON.stringify(roomData)\n})\n.then(r => r.json())\n.then(data => console.log(data));"},{"lang":"python","source":"import requests\nimport json\n\nroom_data = {\n    'id': 'room-uuid-1234',\n    'code': 'ABCD1234',\n    'name': 'Engineering Team',\n    'ownerId': 'owner-uuid-5678',\n    'ownerName': 'John Doe',\n    'maxMembers': 10\n}\n\nheaders = {\n    'Content-Type': 'application/json',\n    'X-CSRF-Token': csrf_token\n}\n\nresponse = requests.post(\n    'http://localhost:3000/api/rooms',\n    headers=headers,\n    json=room_data\n)\nprint(response.json())"}]},"delete":{"operationId":"deleteRoom","tags":["Rooms"],"summary":"Delete Room","description":"Delete a room. Only the room owner can delete. Requires CSRF token and both room code and owner ID to verify ownership.","parameters":[{"name":"code","in":"query","required":true,"description":"Room code (4-8 alphanumeric characters)","schema":{"type":"string","pattern":"^[A-Z0-9]{4,8}$","example":"ABCD1234"}},{"name":"ownerId","in":"query","required":true,"description":"Owner ID (must match the room owner)","schema":{"type":"string","pattern":"^[a-zA-Z0-9-]{1,64}$","example":"owner-uuid-5678"}}],"responses":{"200":{"description":"Room deleted successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Room deleted successfully"}}}}}},"400":{"description":"Missing or invalid parameters","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"403":{"description":"CSRF token missing, invalid, or insufficient permissions","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"404":{"description":"Room not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"429":{"description":"Rate limit exceeded (30 requests/minute)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}},"x-codeSamples":[{"lang":"curl","source":"curl -X DELETE \"http://localhost:3000/api/rooms?code=ABCD1234&ownerId=owner-uuid-5678\" \\\n  -H \"X-CSRF-Token: token-value\""},{"lang":"javascript","source":"const code = 'ABCD1234';\nconst ownerId = 'owner-uuid-5678';\n\nfetch(`http://localhost:3000/api/rooms?code=${code}&ownerId=${ownerId}`, {\n  method: 'DELETE',\n  headers: {\n    'X-CSRF-Token': csrfToken\n  }\n})\n.then(r => r.json())\n.then(data => console.log(data));"},{"lang":"python","source":"import requests\n\ncode = 'ABCD1234'\nowner_id = 'owner-uuid-5678'\ncsrf_token = 'token-value'\n\nheaders = {\n    'X-CSRF-Token': csrf_token\n}\n\nresponse = requests.delete(\n    f'http://localhost:3000/api/rooms?code={code}&ownerId={owner_id}',\n    headers=headers\n)\nprint(response.json())"}]},"options":{"operationId":"roomsOptions","tags":["Rooms"],"summary":"CORS Preflight","description":"Handles CORS preflight requests for /api/rooms endpoint.","parameters":[],"responses":{"204":{"description":"CORS preflight accepted"}}}}},"components":{"schemas":{"HealthResponse":{"type":"object","required":["status","service","timestamp"],"properties":{"status":{"type":"string","enum":["ok","error"],"description":"Health status of the service"},"service":{"type":"string","description":"Service name","example":"tallow"},"version":{"type":"string","description":"Service version","example":"1.0.0"},"timestamp":{"type":"string","format":"date-time","description":"Current server timestamp (ISO 8601)"},"uptime":{"type":"number","description":"Service uptime in seconds","example":3600.5}}},"LivenessResponse":{"type":"object","required":["status","timestamp"],"properties":{"status":{"type":"string","enum":["alive"],"description":"Liveness status"},"timestamp":{"type":"string","format":"date-time","description":"Current server timestamp (ISO 8601)"}}},"DependencyCheck":{"type":"object","required":["name","status"],"properties":{"name":{"type":"string","description":"Name of the dependency","enum":["environment","memory"]},"status":{"type":"string","enum":["healthy","unhealthy"],"description":"Health status of the dependency"},"responseTime":{"type":"number","description":"Check response time in milliseconds"},"error":{"type":"string","description":"Error message if unhealthy"}}},"ReadinessResponse":{"type":"object","required":["status","timestamp","checks"],"properties":{"status":{"type":"string","enum":["ready","not ready","error"],"description":"Overall readiness status"},"timestamp":{"type":"string","format":"date-time","description":"Current server timestamp (ISO 8601)"},"checks":{"type":"array","description":"Individual dependency checks","items":{"$ref":"#/components/schemas/DependencyCheck"}}}},"RoomResponse":{"type":"object","required":["id","code","name","ownerId","ownerName","createdAt","isPasswordProtected","maxMembers","memberCount"],"properties":{"id":{"type":"string","description":"Unique room identifier","example":"room-uuid-1234"},"code":{"type":"string","description":"Room access code (4-8 alphanumeric)","pattern":"^[A-Z0-9]{4,8}$","example":"ABCD1234"},"name":{"type":"string","description":"Human-readable room name","example":"Engineering Team Transfer"},"ownerId":{"type":"string","description":"UUID of the room owner","example":"owner-uuid-5678"},"ownerName":{"type":"string","description":"Name of the room owner","example":"John Doe"},"createdAt":{"type":"string","format":"date-time","description":"Room creation timestamp (ISO 8601)"},"expiresAt":{"type":"string","format":"date-time","nullable":true,"description":"Room expiration timestamp (ISO 8601), null if no expiration"},"isPasswordProtected":{"type":"boolean","description":"Whether the room requires a password to join"},"maxMembers":{"type":"integer","minimum":2,"maximum":50,"description":"Maximum number of members allowed in the room"},"memberCount":{"type":"integer","minimum":0,"description":"Current number of members in the room"}}},"CreateRoomRequest":{"type":"object","required":["id","code","ownerId","ownerName"],"properties":{"id":{"type":"string","pattern":"^[a-zA-Z0-9-]{1,64}$","description":"Unique room identifier","example":"room-uuid-1234"},"code":{"type":"string","pattern":"^[A-Z0-9]{4,8}$","description":"Room access code (4-8 alphanumeric, case-insensitive)","example":"ABCD1234"},"name":{"type":"string","maxLength":50,"description":"Human-readable room name (optional, max 50 chars)","example":"Engineering Team Transfer"},"ownerId":{"type":"string","pattern":"^[a-zA-Z0-9-]{1,64}$","description":"UUID of the room owner","example":"owner-uuid-5678"},"ownerName":{"type":"string","maxLength":50,"description":"Name of the room owner (max 50 chars)","example":"John Doe"},"password":{"type":"string","minLength":4,"maxLength":128,"description":"Optional password to protect the room (4-128 characters)","example":"SecurePassword123"},"maxMembers":{"type":"integer","minimum":2,"maximum":50,"description":"Maximum members allowed (default: 10, range: 2-50)","example":10},"expiresAt":{"type":"string","format":"date-time","description":"Room expiration time (ISO 8601). Max 7 days in future.","example":"2026-02-07T12:00:00Z"}}},"CreateRoomResponse":{"type":"object","required":["success","room"],"properties":{"success":{"type":"boolean","example":true},"room":{"type":"object","required":["id","code","name","ownerId","createdAt","isPasswordProtected","maxMembers"],"properties":{"id":{"type":"string","example":"room-uuid-1234"},"code":{"type":"string","example":"ABCD1234"},"name":{"type":"string","example":"Engineering Team Transfer"},"ownerId":{"type":"string","example":"owner-uuid-5678"},"createdAt":{"type":"string","format":"date-time"},"expiresAt":{"type":"string","format":"date-time","nullable":true},"isPasswordProtected":{"type":"boolean"},"maxMembers":{"type":"integer"}}}}},"ErrorResponse":{"type":"object","required":["error","timestamp"],"properties":{"error":{"type":"string","description":"Human-readable error message","example":"Room not found"},"code":{"type":"string","description":"Machine-readable error code","enum":["BAD_REQUEST","UNAUTHORIZED","FORBIDDEN","NOT_FOUND","CONFLICT","GONE","RATE_LIMIT_EXCEEDED","VALIDATION_ERROR","INTERNAL_ERROR","SERVICE_UNAVAILABLE"],"example":"NOT_FOUND"},"timestamp":{"type":"string","format":"date-time","description":"Timestamp when error occurred (ISO 8601)"},"details":{"type":"object","description":"Additional error details (development mode only)"}}}},"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","description":"JWT or session token authentication (optional)"},"apiKeyAuth":{"type":"apiKey","in":"header","name":"X-API-Key","description":"API key for programmatic access (optional)"},"csrfToken":{"type":"apiKey","in":"header","name":"X-CSRF-Token","description":"CSRF protection token (required for state-changing operations)"}}},"tags":[{"name":"Health","description":"Health check and readiness probe endpoints for monitoring and orchestration"},{"name":"Rooms","description":"Create and manage transfer rooms for group file transfers"}]}
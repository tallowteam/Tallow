```mermaid
sequenceDiagram
    participant S as Sender
    participant Sig as Signaling Server
    participant R as Receiver

    Note over S,R: Phase 1: PQC Handshake

    S->>S: Generate ML-KEM-768 keypair
    S->>S: Generate X25519 keypair

    S->>Sig: Send PQC public keys (hybrid)
    Sig->>R: Forward public keys

    R->>R: ML-KEM-768 Encapsulate
    R->>R: X25519 ECDH (ephemeral)
    R->>R: Combine secrets with HKDF

    R->>Sig: Send ciphertext (hybrid)
    Sig->>S: Forward ciphertext

    S->>S: ML-KEM-768 Decapsulate
    S->>S: X25519 ECDH
    S->>S: Combine secrets with HKDF

    Note over S,R: Both have shared secret

    Note over S,R: Phase 2: Session Key Derivation

    S->>S: HKDF(shared_secret) → session keys
    R->>R: HKDF(shared_secret) → session keys

    Note over S,R: Derived: encryption_key, auth_key, session_id

    Note over S,R: Phase 3: WebRTC Signaling (Encrypted)

    S->>S: Create WebRTC offer
    S->>S: Encrypt offer with session key
    S->>Sig: Send encrypted offer
    Sig->>R: Forward encrypted offer
    R->>R: Decrypt offer

    R->>R: Create WebRTC answer
    R->>R: Encrypt answer
    R->>Sig: Send encrypted answer
    Sig->>S: Forward encrypted answer
    S->>S: Decrypt answer

    Note over S,R: Phase 4: ICE Candidate Exchange

    S->>Sig: ICE candidates (encrypted)
    Sig->>R: Forward ICE candidates
    R->>Sig: ICE candidates (encrypted)
    Sig->>S: Forward ICE candidates

    Note over S,R: P2P Connection Established

    Note over S,R: Phase 5: Triple Ratchet Initialization

    S->>S: Initialize root ratchet
    S->>S: Initialize sending chain
    R->>R: Initialize root ratchet
    R->>R: Initialize receiving chain

    Note over S,R: Phase 6: File Transfer (Per Chunk)

    loop For each file chunk
        S->>S: Generate chunk key (ratchet forward)
        S->>S: Encrypt chunk with AES-256-GCM
        S->>S: Generate HMAC-SHA256 tag
        S->>R: Send encrypted chunk + tag + nonce
        R->>R: Verify HMAC tag
        R->>R: Ratchet forward to derive key
        R->>R: Decrypt chunk
        R->>S: Send ACK
    end

    Note over S,R: Phase 7: Post-Transfer Cleanup

    S->>S: Secure wipe session keys
    S->>S: Wipe ratchet state
    R->>R: Secure wipe session keys
    R->>R: Wipe ratchet state

    Note over S,R: Forward secrecy maintained
```

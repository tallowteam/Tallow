---
phase: 21-web-ui-browser-client
plan: 03
type: execute
wave: 2
depends_on:
  - 21-01
  - 21-02
files_modified:
  - crates/tallow-web/src/lib.rs
  - crates/tallow-web/src/transport.rs
  - crates/tallow-web/src/transfer.rs
  - crates/tallow-web/src/file_io.rs
  - web/index.html
  - web/style.css
  - web/app.ts
  - web/transfer.ts
  - web/wasm.ts
autonomous: true
requirements:
  - WEB-07
  - WEB-08
  - WEB-09
  - WEB-10
  - WEB-11

must_haves:
  truths:
    - "Browser connects to relay via WebSocket, joins a room, and exchanges postcard-encoded messages"
    - "Browser performs full KEM handshake (HandshakeInit/Response/Kem/Complete) with CLI peer using WASM crypto"
    - "Browser can send files via drag-and-drop with 64KB chunked AES-256-GCM encryption matching CLI wire format"
    - "Browser can receive files from CLI peer with progressive decryption and download via StreamSaver.js"
    - "Real-time transfer progress shows speed (MB/s), percentage, and ETA"
  artifacts:
    - path: "crates/tallow-web/src/transport.rs"
      provides: "WebSocket connection wrapper with send/receive for postcard bytes"
      contains: "WebSocket"
    - path: "crates/tallow-web/src/transfer.rs"
      provides: "File chunking state machine, send/receive orchestration"
      contains: "encrypt_chunk"
    - path: "crates/tallow-web/src/file_io.rs"
      provides: "Browser File/Blob reading, download triggering"
      contains: "FileReader"
    - path: "web/index.html"
      provides: "Main page with landing hero, code phrase entry, dashboard layout"
      contains: "Post-Quantum Encrypted"
    - path: "web/style.css"
      provides: "Dark theme CSS with deep blue/purple palette"
      contains: "#0f172a"
    - path: "web/app.ts"
      provides: "Application logic, state machine, WebSocket lifecycle"
      contains: "wasm"
    - path: "web/transfer.ts"
      provides: "File transfer UI, drag-and-drop, progress bars"
      contains: "dragover"
  key_links:
    - from: "web/app.ts"
      to: "crates/tallow-web"
      via: "WASM module import"
      pattern: "import.*tallow_web"
    - from: "web/transfer.ts"
      to: "web/app.ts"
      via: "WebSocket send function"
      pattern: "ws.send"
    - from: "crates/tallow-web/src/transport.rs"
      to: "web-sys::WebSocket"
      via: "browser API binding"
      pattern: "web_sys::WebSocket"
---

<objective>
Build the browser file transfer UI with WebSocket transport, KEM handshake, drag-and-drop file send/receive, and real-time progress.

Purpose: This is the core browser experience — a user visits the URL, enters a code phrase, connects to the relay via WebSocket, performs the cryptographic handshake with a CLI peer, and transfers files with real-time progress. The UI implements the user's design decisions: dark theme, hero security messaging, dashboard layout, deep links, QR codes, step-by-step handshake visual, full-width progress bars, and polished transitions.

Output: A working web app at `web/` that can send and receive files interoperably with the CLI client.
</objective>

<execution_context>
@C:/Users/Aamir/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Aamir/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-web-ui-browser-client/21-01-SUMMARY.md
@.planning/phases/21-web-ui-browser-client/21-02-SUMMARY.md
@.planning/phases/21-web-ui-browser-client/21-CONTEXT.md
@crates/tallow-web/src/lib.rs
@crates/tallow-web/src/crypto.rs
@crates/tallow-web/src/codec.rs
@crates/tallow-protocol/src/wire/messages.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: WASM transport module + browser file I/O helpers + TypeScript WASM bridge</name>
  <files>
    crates/tallow-web/src/lib.rs
    crates/tallow-web/src/transport.rs
    crates/tallow-web/src/transfer.rs
    crates/tallow-web/src/file_io.rs
    web/wasm.ts
  </files>
  <action>
    **transport.rs — WebSocket connection wrapper (WASM side):**

    Create a minimal WASM-side WebSocket helper. Note: most WebSocket logic will be in TypeScript (since web-sys WebSocket is callback-based and easier to manage in JS). The Rust transport module provides:

    1. `WsTransport` struct (exported via wasm-bindgen):
       - Not a WebSocket itself — the TypeScript side owns the WebSocket
       - Provides message encoding/decoding helpers
       - `prepare_room_join(room_id: &[u8], password_hash: Option<Vec<u8>>) -> Vec<u8>` — encode RoomJoin message ready to send
       - `prepare_room_join_multi(room_id: &[u8], password_hash: Option<Vec<u8>>, capacity: u8) -> Vec<u8>` — encode RoomJoinMulti
       - `parse_room_response(data: &[u8]) -> Result<JsValue, JsValue>` — decode response, return {type: "RoomJoined", peer_present: bool} or {type: "RoomJoinedMulti", peer_id: u8, existing_peers: [u8]}

    **transfer.rs — File transfer state machine (WASM side):**

    1. `TransferSession` struct (exported via wasm-bindgen):
       - `new(session_key: &[u8], transfer_id: &[u8]) -> TransferSession`
       - `prepare_file_offer(manifest_bytes: &[u8]) -> Vec<u8>` — encode FileOffer
       - `prepare_chunk(index: u64, total: Option<u64>, plaintext: &[u8]) -> Result<Vec<u8>, JsValue>` — encrypt with AES-256-GCM (counter = index, AAD = chunk-index binding matching CLI), then encode as Chunk message
       - `decrypt_chunk(index: u64, chunk_data: &[u8]) -> Result<Vec<u8>, JsValue>` — extract ciphertext from Chunk message, decrypt
       - `prepare_ack(index: u64) -> Vec<u8>` — encode Ack
       - `prepare_transfer_complete(hash: &[u8], merkle_root: Option<Vec<u8>>) -> Vec<u8>` — encode TransferComplete
       - `current_chunk_index(&self) -> u64` — for progress tracking

    CRITICAL: The AAD for chunk encryption MUST match the CLI exactly. In the CLI, chunk AAD binds the chunk index. Look at `crates/tallow-protocol/src/transfer/send.rs` and `receive.rs` to see the exact AAD construction — replicate it identically.

    **file_io.rs — Browser file reading/download helpers (WASM side):**

    Minimal helpers — most file I/O is better handled in TypeScript:
    1. `compute_file_manifest(files_json: &str) -> Result<Vec<u8>, JsValue>` — takes a JSON array of {name, size, path} file descriptions, builds a manifest structure compatible with CLI FileManifest, returns postcard-encoded bytes
    2. `parse_file_manifest(manifest_bytes: &[u8]) -> Result<JsValue, JsValue>` — decode manifest, return JS-friendly object with file list

    Update `lib.rs` to add `pub mod transport; pub mod transfer; pub mod file_io;`

    **web/wasm.ts — TypeScript WASM bridge:**

    Create the TypeScript module that loads and initializes the WASM module:

    ```typescript
    // web/wasm.ts
    // Loads and initializes the tallow-web WASM module
    import init, * as wasm from './pkg/tallow_web.js';

    let initialized = false;

    export async function initWasm(): Promise<typeof wasm> {
        if (!initialized) {
            await init();
            initialized = true;
        }
        return wasm;
    }

    export { wasm };
    ```

    This provides a single initialization point. All other TS modules import from wasm.ts.
  </action>
  <verify>
    Run `cargo build -p tallow-web --target wasm32-unknown-unknown --release`. Verify transport.rs, transfer.rs, file_io.rs compile. Check that wasm.ts is syntactically valid TypeScript.
  </verify>
  <done>
    WASM modules provide WebSocket message preparation, file transfer state machine with correct AAD/nonce construction, manifest encoding/decoding. TypeScript WASM bridge provides clean initialization. All compile to wasm32-unknown-unknown.
  </done>
</task>

<task type="auto">
  <name>Task 2: Web UI — HTML structure, CSS theme, and core application logic</name>
  <files>
    web/index.html
    web/style.css
    web/app.ts
    web/transfer.ts
  </files>
  <action>
    **IMPORTANT USER DECISIONS TO IMPLEMENT:**
    - Dark theme default (deep blue/purple: #0f172a backgrounds, blue accents)
    - Hero-level security messaging ("Post-Quantum Encrypted" prominent)
    - Landing page first, scroll to action area
    - Dashboard layout with all 3 modes visible (NOT tabs)
    - Explicit "Send Files" and "Receive Files" buttons
    - Both code entry and generation with tabs
    - Deep links (`?code=...`)
    - QR code for code phrases
    - Ctrl+K command palette
    - Step-by-step handshake visual
    - Full-width progress bar (like WeTransfer)
    - Summary card on transfer complete
    - Large bordered drop zone
    - Polished transitions between states
    - System fonts only (Inter/system-ui)
    - Dark + light mode toggle
    - File size limit: soft 1GB warning, block above 4GB
    - Folder upload via webkitdirectory
    - Both initial batch + "Add more files" button
    - Simple accept/reject for received files
    - Connection indicator: small colored dot (green/yellow/red)
    - Optional expandable peer fingerprint
    - Offline banner with auto-reconnect
    - Basic semantic HTML accessibility
    - Settings panel (relay URL, theme, compression, shortcuts)
    - No sounds
    - English only

    **web/index.html:**

    Single-page app structure. Semantic HTML5:

    ```html
    <!DOCTYPE html>
    <html lang="en" data-theme="dark">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tallow — Post-Quantum Encrypted File Transfer</title>
        <meta name="description" content="Send files with post-quantum encryption. No install needed.">
        <link rel="stylesheet" href="style.css">
        <!-- Open Graph / social sharing -->
        <meta property="og:title" content="Tallow — Post-Quantum Encrypted File Transfer">
        <meta property="og:description" content="Send files securely with quantum-resistant encryption. Works in your browser.">
        <meta property="og:type" content="website">
        <!-- CSP: strict, no inline scripts, WASM from self only -->
        <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'wasm-unsafe-eval'; connect-src 'self' wss://*.manisahome.com; style-src 'self' 'unsafe-inline';">
        <link rel="manifest" href="manifest.json">
    </head>
    <body>
        <!-- Offline banner -->
        <div id="offline-banner" class="offline-banner hidden" role="alert">
            You are offline. Reconnecting...
        </div>

        <!-- Landing / Hero section -->
        <section id="landing" class="landing">
            <header class="hero">
                <h1>Tallow</h1>
                <p class="tagline">Post-Quantum Encrypted File Transfer</p>
                <div class="security-badges">
                    <span class="badge">ML-KEM-1024</span>
                    <span class="badge">AES-256-GCM</span>
                    <span class="badge">Zero Knowledge Relay</span>
                </div>
                <p class="hero-description">Send files, share clipboard, and chat — all end-to-end encrypted with quantum-resistant cryptography. No install needed.</p>
            </header>
            <!-- Features overview -->
            <div class="features-grid">
                <!-- 3-4 feature cards -->
            </div>
            <!-- Action area -->
            <div class="action-area">
                <div class="role-selection">
                    <button id="btn-send" class="role-btn primary">Send Files</button>
                    <button id="btn-receive" class="role-btn secondary">Receive Files</button>
                </div>
            </div>
        </section>

        <!-- Code phrase entry/generation -->
        <section id="code-section" class="code-section hidden">
            <div class="code-tabs">
                <button class="tab active" data-tab="enter">Enter a Code</button>
                <button class="tab" data-tab="generate">Generate a Code</button>
            </div>
            <div id="tab-enter" class="tab-panel">
                <input type="text" id="code-input" placeholder="e.g., 7-gamma-bravo" autocomplete="off" aria-label="Code phrase">
                <button id="btn-connect">Connect</button>
            </div>
            <div id="tab-generate" class="tab-panel hidden">
                <div id="generated-code" class="generated-code"></div>
                <div id="qr-code" class="qr-code"></div>
                <p class="hint">Share this code with your peer</p>
                <button id="btn-wait">Wait for Peer</button>
            </div>
        </section>

        <!-- Handshake progress -->
        <section id="handshake-section" class="handshake-section hidden">
            <div class="handshake-steps">
                <div class="step" data-step="connect">
                    <span class="step-icon"></span>
                    <span class="step-label">Connecting to Relay</span>
                </div>
                <div class="step" data-step="waiting">
                    <span class="step-icon"></span>
                    <span class="step-label">Waiting for Peer</span>
                </div>
                <div class="step" data-step="kex">
                    <span class="step-icon"></span>
                    <span class="step-label">Key Exchange</span>
                </div>
                <div class="step" data-step="ready">
                    <span class="step-icon"></span>
                    <span class="step-label">PQ Encryption Active</span>
                </div>
            </div>
            <div class="connection-dot" id="connection-dot"></div>
        </section>

        <!-- Dashboard (visible after handshake) -->
        <section id="dashboard" class="dashboard hidden">
            <!-- All 3 modes visible at once -->
            <div class="dashboard-grid">
                <!-- File transfer panel -->
                <div class="panel panel-files">
                    <h2>Files</h2>
                    <!-- Drop zone (sender) or file list (receiver) -->
                    <div id="drop-zone" class="drop-zone">
                        <p>Drop files here or click to browse</p>
                        <input type="file" id="file-input" multiple hidden>
                        <input type="file" id="folder-input" webkitdirectory hidden>
                        <div class="upload-actions">
                            <button id="btn-add-files">Add Files</button>
                            <button id="btn-add-folder">Add Folder</button>
                        </div>
                    </div>
                    <div id="file-list" class="file-list hidden"></div>
                    <div id="send-controls" class="send-controls hidden">
                        <label><input type="checkbox" id="compress-toggle" checked> Compress</label>
                        <button id="btn-send-files" class="primary">Send</button>
                    </div>
                    <!-- Receive: accept/reject -->
                    <div id="receive-offer" class="receive-offer hidden">
                        <div id="offer-details"></div>
                        <div class="offer-actions">
                            <button id="btn-accept" class="primary">Accept</button>
                            <button id="btn-reject" class="danger">Reject</button>
                        </div>
                    </div>
                    <!-- Progress -->
                    <div id="transfer-progress" class="transfer-progress hidden">
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progress-bar"></div>
                        </div>
                        <div class="progress-stats">
                            <span id="progress-percent">0%</span>
                            <span id="progress-speed">0 MB/s</span>
                            <span id="progress-eta">--:--</span>
                        </div>
                    </div>
                    <!-- Transfer complete summary -->
                    <div id="transfer-summary" class="transfer-summary hidden"></div>
                </div>

                <!-- Clipboard panel -->
                <div class="panel panel-clipboard">
                    <h2>Clipboard</h2>
                    <button id="btn-share-clipboard">Share Clipboard</button>
                    <div id="clipboard-status"></div>
                </div>

                <!-- Chat panel -->
                <div class="panel panel-chat">
                    <h2>Chat</h2>
                    <div id="chat-messages" class="chat-messages"></div>
                    <div class="chat-input-area">
                        <input type="text" id="chat-input" placeholder="Type a message..." aria-label="Chat message">
                        <button id="btn-emoji">&#128512;</button>
                        <button id="btn-send-chat">Send</button>
                    </div>
                </div>
            </div>

            <!-- Peer info (expandable) -->
            <details class="peer-info">
                <summary>Verify Peer</summary>
                <div id="peer-fingerprint"></div>
            </details>
        </section>

        <!-- Settings panel (overlay) -->
        <div id="settings-panel" class="settings-panel hidden">
            <h2>Settings</h2>
            <label>Relay URL <input type="text" id="setting-relay" value="wss://tallow.manisahome.com/ws"></label>
            <label>Theme <select id="setting-theme"><option value="dark">Dark</option><option value="light">Light</option></select></label>
            <label><input type="checkbox" id="setting-compression" checked> Enable compression</label>
            <div class="shortcuts-display">
                <h3>Keyboard Shortcuts</h3>
                <p>Ctrl+K: Command palette</p>
                <p>Ctrl+S: Send files</p>
                <p>Ctrl+V: Paste clipboard</p>
                <p>Escape: Close panel</p>
            </div>
            <button id="btn-close-settings">Close</button>
        </div>

        <!-- Command palette (Ctrl+K) -->
        <div id="command-palette" class="command-palette hidden">
            <input type="text" id="cmd-search" placeholder="Type a command..." aria-label="Command search">
            <div id="cmd-results" class="cmd-results"></div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <a href="https://github.com/tallowteam/Tallow">GitHub</a>
            <span>|</span>
            <span>CLI: <code>cargo install tallow</code></span>
            <span>|</span>
            <span>AGPL-3.0</span>
        </footer>

        <!-- Scripts -->
        <script type="module" src="app.js"></script>
    </body>
    </html>
    ```

    **web/style.css:**

    Implement the complete CSS theme per user decisions:
    - CSS custom properties for theming: `--bg-primary: #0f172a`, `--bg-secondary: #1e293b`, `--accent: #3b82f6`, `--text: #f8fafc`, etc.
    - `[data-theme="light"]` overrides with light palette
    - System font stack: `font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif`
    - Rounded corners (`border-radius: 12px` for cards, `8px` for buttons)
    - Smooth gradients on hero section
    - Full-width progress bar (like WeTransfer style)
    - Large drop zone with dashed border (`border: 2px dashed var(--border)`)
    - Polished transitions: `transition: all 0.3s ease` on state changes, slide/scale for section transitions
    - Dashboard grid: CSS Grid with responsive columns (`grid-template-columns: repeat(auto-fit, minmax(300px, 1fr))`)
    - Mobile-first responsive design (equal weight per user decision)
    - `.hidden` class: `display: none`
    - Handshake step indicators with animated dots/checkmarks
    - Connection dot: small circle with colors (green=#22c55e, yellow=#eab308, red=#ef4444)
    - Command palette: centered overlay with blur backdrop
    - Settings panel: slide-in from right
    - Chat messages: scrollable container, alternating alignment
    - Offline banner: fixed top, yellow background

    **web/app.ts:**

    Main application logic (compile to JS or use as-is if using plain JS):

    Note on build tooling (Claude's discretion per CONTEXT.md): Use plain TypeScript compiled with `tsc` (no bundler). The app is small (<10 modules). Ship individual JS files or use a simple `tsc --outDir web/dist` build step. No Vite/webpack/esbuild needed.

    State machine for the app:
    - `landing` → user clicks Send/Receive
    - `code-entry` → user enters/generates code
    - `connecting` → WebSocket connecting to relay
    - `waiting` → waiting for peer in room
    - `handshake` → KEM handshake in progress
    - `dashboard` → connected, all 3 panels active
    - `transferring` → file transfer in progress
    - `complete` → transfer done, summary card

    Core logic:
    1. On page load: check URL params for `?code=...` deep link
    2. Initialize WASM module (`initWasm()`)
    3. Read settings from localStorage
    4. Detect online/offline status, show banner

    WebSocket lifecycle:
    1. `connect(relayUrl, roomId)` — open WebSocket, set binary type to arraybuffer
    2. On open: send RoomJoin message (postcard-encoded via WASM)
    3. On message: dispatch based on decoded message type
    4. On close/error: show error with retry button, auto-reconnect if transfer in progress

    KEM handshake flow (browser as receiver — most common web use case):
    1. Receive HandshakeInit from CLI sender
    2. Generate ephemeral hybrid keypair via WASM
    3. Send HandshakeResponse with public key
    4. Receive HandshakeKem with ciphertext
    5. Decapsulate to get shared secret via WASM
    6. Derive session key via HKDF
    7. Send HandshakeComplete with confirmation

    Also handle browser-as-sender:
    1. Generate keypair
    2. Send HandshakeInit
    3. Receive HandshakeResponse with peer's public key
    4. Encapsulate to get shared secret + ciphertext
    5. Send HandshakeKem
    6. Receive HandshakeComplete
    7. Derive session key

    Update handshake visual steps as each completes.

    **web/transfer.ts:**

    File transfer UI logic:

    **Sending:**
    1. Drag-and-drop handler on drop zone + file input change handler
    2. File size validation: warn >1GB, block >4GB with message "Use the CLI for large transfers"
    3. Folder upload via webkitdirectory attribute
    4. "Add more files" button stays visible
    5. Build manifest from selected files (name, size, relative path)
    6. Send FileOffer via WebSocket
    7. Wait for FileAccept
    8. Chunk files using `Blob.slice(offset, offset + 65536)`:
       ```typescript
       for (const file of files) {
           let offset = 0;
           while (offset < file.size) {
               const slice = file.slice(offset, Math.min(offset + 65536, file.size));
               const buffer = await slice.arrayBuffer();
               const plaintext = new Uint8Array(buffer);
               const msgBytes = wasmTransfer.prepare_chunk(chunkIndex, total, plaintext);
               ws.send(msgBytes);
               offset += 65536;
               chunkIndex++;
               updateProgress(chunkIndex, totalChunks, totalBytes);
           }
       }
       ```
    9. Send TransferComplete with BLAKE3 hash
    10. Show summary card (files, size, time, speed, hash verified)

    **Receiving:**
    1. Receive FileOffer, parse manifest, show accept/reject UI
    2. On accept: send FileAccept, prepare for incoming chunks
    3. For each Chunk: decrypt via WASM, accumulate in memory (small files) or stream via StreamSaver.js (large files)
    4. For StreamSaver.js: include it as a vendored JS file or reference from CDN. On first chunk, create a WritableStream. Pipe decrypted chunks to it. The browser will prompt the user to save.
    5. On TransferComplete: verify BLAKE3 hash, show summary card
    6. Handle multiple files: process sequentially or use manifest to route chunks

    **Progress display:**
    - Update progress bar width as percentage of chunks sent/received
    - Calculate speed: bytes transferred / elapsed time
    - Calculate ETA: remaining bytes / current speed
    - Update at least once per second (batch UI updates)
    - Full-width progress bar spanning the file panel

    **QR Code:**
    Use a minimal QR code library (e.g., qrcode-generator, ~3KB) or generate QR as SVG from a simple JS function. Display alongside the text code phrase when generating a code. The QR encodes the deep link URL: `https://tallow.manisahome.com?code=<phrase>`.

    **File size formatting:**
    Human-readable sizes (e.g., "1.43 MiB"). Use a simple helper function.

    **Keyboard shortcuts:**
    - `Ctrl+K` / `Cmd+K`: toggle command palette
    - `Ctrl+S` / `Cmd+S`: trigger send (if files selected)
    - `Escape`: close overlay/palette
    - Register via `document.addEventListener('keydown', ...)`

    **Command palette:**
    Simple filter over a list of commands: ["Send Files", "Receive Files", "Share Clipboard", "Settings", "Toggle Theme", "Disconnect"]. Filter as user types. Execute on Enter/click.

    **Theme toggle:**
    Toggle `data-theme` attribute on `<html>`. Persist to localStorage. Read on page load.

    **Transfer resume:**
    On disconnect during transfer: save chunk progress to sessionStorage. On reconnect: send ResumeInfo with verified chunks. Continue from last chunk.

    **Transfer history:**
    After each transfer: save {timestamp, files, totalSize, duration, speed} to localStorage, encrypted with a key derived from a browser-generated random secret (also in localStorage). Show history in a collapsible section.
  </action>
  <verify>
    Build WASM: `cargo build -p tallow-web --target wasm32-unknown-unknown --release`. Run wasm-bindgen CLI to generate JS bindings. Open `web/index.html` in a browser (via local HTTP server — `python -m http.server 8080`). Verify: (1) WASM loads without errors in console, (2) Landing page renders with hero and buttons, (3) Dark theme applied, (4) Click "Receive" shows code entry, (5) Enter a code shows connecting state.
  </verify>
  <done>
    Web UI renders correctly with dark theme, hero, landing page, code entry, handshake visual, dashboard with file/clipboard/chat panels. WebSocket connects to relay. KEM handshake completes with CLI peer. Files can be sent via drag-and-drop with 64KB chunked encryption. Files can be received with progressive decryption. Progress shows speed, percentage, ETA. WEB-07, WEB-08, WEB-09, WEB-10, WEB-11 satisfied.
  </done>
</task>

</tasks>

<verification>
1. WASM module loads in browser without errors (check console)
2. WebSocket connects to relay at configured URL (WEB-07)
3. KEM handshake completes between browser and CLI peer (WEB-08)
4. Drag-and-drop file sending with 64KB chunked AES-256-GCM encryption works (WEB-09)
5. File receiving with progressive decryption and download works (WEB-10)
6. Progress bar shows speed, percentage, ETA updating in real-time (WEB-11)
7. Dark theme with deep blue/purple palette renders correctly
8. Landing page shows hero with "Post-Quantum Encrypted" branding
9. Dashboard shows all 3 panels simultaneously
10. Deep link ?code=... pre-fills code phrase
11. QR code displays alongside generated code
12. Ctrl+K opens command palette
13. Theme toggle works between dark and light
14. File size warnings at 1GB, block at 4GB
15. Folder upload via webkitdirectory works
</verification>

<success_criteria>
- Browser connects to relay via WebSocket and exchanges postcard messages (WEB-07)
- Full KEM handshake with CLI peer via WASM crypto (WEB-08)
- File send via drag-and-drop with correct chunked encryption (WEB-09)
- File receive with progressive decryption and download (WEB-10)
- Real-time progress with speed, percentage, ETA (WEB-11)
- All user design decisions implemented (dark theme, hero, dashboard layout, QR codes, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/21-web-ui-browser-client/21-03-SUMMARY.md`
</output>

# Default values for tallow
# This is a YAML-formatted file
# Declare variables to be passed into your templates

# Global settings
global:
  domain: tallow.manisahome.com

# Container image configuration
image:
  registry: ghcr.io
  repository: your-username/tallow
  pullPolicy: IfNotPresent
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Web application configuration
web:
  enabled: true
  replicaCount: 3

  image:
    name: web
    # Override global image settings if needed
    # repository: ""
    # tag: ""

  service:
    type: ClusterIP
    port: 3000
    annotations: {}

  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 2Gi

  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  podDisruptionBudget:
    enabled: true
    minAvailable: 2

  livenessProbe:
    enabled: true
    path: /api/health
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    enabled: true
    path: /api/ready
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

  env:
    NODE_ENV: production
    NEXT_TELEMETRY_DISABLED: "1"

# Signaling server configuration
signaling:
  enabled: true
  replicaCount: 2

  image:
    name: signaling

  service:
    type: ClusterIP
    port: 3001
    annotations: {}

  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 512Mi

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 8
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  podDisruptionBudget:
    enabled: true
    minAvailable: 1

  livenessProbe:
    enabled: true
    path: /health
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    enabled: true
    path: /health
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

  env:
    SIGNALING_PORT: "3001"
    ALLOWED_ORIGINS: "https://tallow.manisahome.com"

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    nginx.ingress.kubernetes.io/limit-rps: "20"

  hosts:
    - host: tallow.manisahome.com
      paths:
        - path: /
          pathType: Prefix
          service: web
        - path: /signaling
          pathType: Prefix
          service: signaling

  tls:
    - secretName: tallow-tls
      hosts:
        - tallow.manisahome.com

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: "tallow"

# RBAC configuration
rbac:
  create: true

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  fsGroup: 1001
  seccompProfile:
    type: RuntimeDefault

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1001
  capabilities:
    drop:
      - ALL

# Network policy
networkPolicy:
  enabled: true

# Secrets configuration
secrets:
  create: false
  name: tallow-secrets
  data: {}
    # RESEND_API_KEY: ""
    # STRIPE_SECRET_KEY: ""
    # STRIPE_WEBHOOK_SECRET: ""
    # NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: ""

# ConfigMap
configMap:
  create: true
  data:
    NODE_ENV: "production"
    NEXT_TELEMETRY_DISABLED: "1"
    SIGNALING_PORT: "3001"
    ALLOWED_ORIGINS: "https://tallow.manisahome.com"
    NEXT_PUBLIC_FORCE_RELAY: "true"
    NEXT_PUBLIC_ALLOW_DIRECT: "false"

# Monitoring
monitoring:
  enabled: true
  prometheus:
    enabled: true
    port: 3000
    path: /api/metrics

# Node affinity
affinity: {}

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Pod annotations
podAnnotations: {}

# Pod labels
podLabels: {}

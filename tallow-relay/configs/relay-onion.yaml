# Tallow Onion Relay Configuration
# This configuration file is for running a relay node in TALLOW's onion routing network.

server:
  host: "0.0.0.0"
  port: 8080
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s
  max_header_bytes: 1048576  # 1MB
  shutdown_timeout: 30s

# Onion routing configuration
onion:
  # Relay operating mode: entry, middle, exit, or directory
  mode: "middle"

  # Unique relay identifier (auto-generated if empty)
  relay_id: ""

  # Public WebSocket URL for this relay (how other relays connect to us)
  # Example: "wss://relay.example.com:8080"
  public_endpoint: ""

  # Directory server URL for relay registration and discovery
  directory_url: ""

  # Path to store PQC keys
  key_store_path: "/var/lib/tallow-relay/keys"

  # Maximum number of concurrent circuits
  max_circuits: 10000

  # How long a circuit can be idle before cleanup
  circuit_timeout: 30m

  # Maximum bandwidth in bytes/sec (0 = unlimited)
  max_bandwidth: 0

  # Which relay modes can connect to us
  allowed_modes:
    - entry
    - middle
    - exit

  # List of trusted relay IDs (for priority handling)
  trusted_relays: []

  # Require authentication for relay-to-relay connections
  require_auth: false

# Rate limiting
rate_limit:
  enabled: true
  requests_per_second: 100
  burst_size: 200
  cleanup_interval: 10m
  ban_duration: 1h
  max_violations: 10

# Bridge/tunnel settings
bridge:
  buffer_size: 65536  # 64KB
  max_message_size: 67108864  # 64MB
  read_deadline: 60s
  write_deadline: 30s
  ping_interval: 30s
  pong_timeout: 10s
  max_bytes_per_room: 10737418240  # 10GB
  idle_timeout: 5m

# TLS configuration
tls:
  enabled: false
  cert_file: ""
  key_file: ""
  auto_tls: false

# Metrics/monitoring
metrics:
  enabled: true
  path: "/metrics"
  health_path: "/health"
  ready_path: "/ready"
  port: 9090
  namespace: "tallow_relay"
